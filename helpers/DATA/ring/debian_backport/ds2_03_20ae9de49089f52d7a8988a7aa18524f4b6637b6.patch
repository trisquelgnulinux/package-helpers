From 20ae9de49089f52d7a8988a7aa18524f4b6637b6 Mon Sep 17 00:00:00 2001
From: Amin Bandali <bandali@gnu.org>
Date: Sat, 25 Feb 2023 14:52:30 -0500
Subject: [PATCH] Add patch to change two CMake variables into proper options

---
 debian/patches/1010-cmake-options.patch | 80 +++++++++++++++++++++++++
 debian/patches/series                   |  1 +
 2 files changed, 81 insertions(+)
 create mode 100644 debian/patches/1010-cmake-options.patch

diff --git a/debian/patches/1010-cmake-options.patch b/debian/patches/1010-cmake-options.patch
new file mode 100644
index 00000000..4640e58c
--- /dev/null
+++ b/debian/patches/1010-cmake-options.patch
@@ -0,0 +1,80 @@
+From a6367d50826811caf7cf315f33e7d6cde9677911 Mon Sep 17 00:00:00 2001
+From: Amin Bandali <amin.bandali@savoirfairelinux.com>
+Date: Sat, 25 Feb 2023 14:42:02 -0500
+Subject: [PATCH] cmake: Change two variables into proper options.
+Forwarded: no
+Last-Update: 2023-02-25
+
+Make WITH_DAEMON_SUBMODULE and WITH_WEBENGINE into proper options.
+Also, pass src/libclient/webresource.qrc to qt_add_executable only
+if WITH_WEBENGINE.
+---
+ CMakeLists.txt | 22 +++++++++-------------
+ 1 file changed, 9 insertions(+), 13 deletions(-)
+
+diff --git a/CMakeLists.txt b/CMakeLists.txt
+index d4e24da0..fc023d96 100644
+--- a/CMakeLists.txt
++++ b/CMakeLists.txt
+@@ -38,16 +38,16 @@ set(CMAKE_AUTORCC ON)
+ set(CMAKE_AUTOUIC ON)
+ set(CMAKE_INCLUDE_CURRENT_DIR ON)
+ 
++option(WITH_DAEMON_SUBMODULE "Build with the daemon submodule" OFF)
++option(WITH_WEBENGINE "Build with Qt WebEngine" ON)
++
+ # Main project directories:
+ 
+ # jami-daemon
+-if(NOT DEFINED WITH_DAEMON_SUBMODULE)
+-  set(WITH_DAEMON_SUBMODULE false)
+-  # daemon
+-  set(DAEMON_DIR ${PROJECT_SOURCE_DIR}/../daemon)
+-else()
+-  # daemon
++if(WITH_DAEMON_SUBMODULE)
+   set(DAEMON_DIR ${PROJECT_SOURCE_DIR}/daemon)
++else()
++  set(DAEMON_DIR ${PROJECT_SOURCE_DIR}/../daemon)
+ endif()
+ # src
+ set(LIBCLIENT_SRC_DIR ${PROJECT_SOURCE_DIR}/src/libclient)
+@@ -96,17 +96,12 @@ set(QT_MODULES
+   Widgets
+   Positioning)
+ 
+-if(NOT DEFINED WITH_WEBENGINE)
+-  set(WITH_WEBENGINE true)
+-endif()
+-
+ if(WITH_WEBENGINE)
+   list(APPEND QT_MODULES
+     WebEngineCore
+     WebEngineQuick
+     WebChannel
+-    WebEngineWidgets
+-    )
++    WebEngineWidgets)
+ endif()
+ 
+ set(CMAKE_CXX_FLAGS
+@@ -286,6 +281,7 @@ set(COMMON_HEADERS
+ if(WITH_WEBENGINE)
+   list(APPEND COMMON_SOURCES
+     ${APP_SRC_DIR}/previewengine.cpp)
++  set(QML_WEBRESOURCES ${LIBCLIENT_SRC_DIR}/webresource.qrc)
+   add_definitions(-DWITH_WEBENGINE)
+ else()
+   list(APPEND COMMON_SOURCES
+@@ -492,7 +488,7 @@ qt_add_executable(
+   ${COMMON_SOURCES}
+   ${QML_RESOURCES}
+   ${QML_RESOURCES_QML}
+-  ${LIBCLIENT_SRC_DIR}/webresource.qrc
++  ${QML_WEBRESOURCES}
+   ${SFPM_OBJECTS})
+ 
+ foreach(MODULE ${QT_MODULES})
+-- 
+2.39.2
+
diff --git a/debian/patches/series b/debian/patches/series
index ea657633..42ab30cd 100644
--- a/debian/patches/series
+++ b/debian/patches/series
@@ -1,4 +1,5 @@
 1000-appstream-categories.patch
+1010-cmake-options.patch
 2000-jsoncpp-rename.patch
 2010-dont-build-gnutls.patch
 2020-dont-build-msgpack.patch
-- 
GitLab

